---
layout: post
title: EBS Multi-Attach, EFS
date: 2024-07-29
category: AWS
---

# AWS

> AWS DVA-C02 시험 공부 과정을 블로그에 기록하고자 한다!! <br>
> 강의는 [udemy](https://www.udemy.com/share/105Hxw3@0cQdz1131EH9l6miYRGC7Z2Im8bmTMdAo7U-M_IUQA0101eYlVeFerKpk6CkYQwlDA==/) 강의를 참고하였다.

<br>

# EBS 다중 연결 (EBS Multi-Attach) - io1/io2 family
- EBS 다중 첨부 기능을 사용하면 동일 EBS 볼륨을 동일한 가용 영역에 있는 여러개의 EC2 인스턴스에 첨부할 수 있다. 
  - 단 io1, io2 제품군에만 사용할 수 있다.
- 각 인스턴스는 고성능 볼륨에 대한 전체 읽기 및 쓰기 권한을 갖게 된다.
- 클러스터된 Linux 애플리케이션의 경우, 애플리케이션 가용성이 높아진다. (ex. Teradata?)
- 한 AZ의 EBS 볼륨을 다른 AZ에 첨부할 수 없다. 
- 하나의 볼륨은 한번에 최대 **16개** 의 EC2 인스턴스에 부착할 수 있다. 
- 클러스터를 인식 할 수 있는 파일 시스템을 사용해야한다. (XFS, Xe4)

![alt text](\public\img\aws9-1.png){: width="300" height ="80" }


# EFS - Elastic File System
- 관리형 NFS(Network File System)로 많은 EC2 인스턴스에 마운트 될 수 있는 네트워크 파일 시스템다.
  - 이 때 EC2 인스턴스는 다른 AZ에 있을 수 있다. 
- 가용성이 높고 확장성이 뛰어나며 비싸다(GP2 EBS볼륨의 3배이다.)

- EFS 사용 사례
  - 콘텐츠 관리
  - 웹 서빙
  - 데이터 공유
  - 워드프레스
- NFS 프로토콜을 사용하며, EFS에 대한 액세스를 제어하려면 보안 그룹을 설정해야한다. 
- 윈도우가 아닌 Linux 기반 AMI와만 호환된다.
- KMS를 사용해서 EFS 드라이브에서 미사용 암호화를 활성화할 수 있다. 
- Posix 시스템 사용
- 용량을 미리 계획할 필요가 없음 (파일 시스템은 자동으로 확장되고 사용하는 GB 사용량에 따라 비용을 지불한다.)

### EFS 성능 & 스토리지 클래스
#### EFS 성능
- EFS 스케일: 동시 NFS클라이언트 수천 개와 10GB 이상의 처리량을 확보할 수 있고 PB 규모의 네트워크 파일 시스템으로 자동 확장 가능
- Performance Mode
  - 범용(기본값): 지연 시간에 민감한 사용 사례에 사용된다(웹서버, CMS)
  - 최대 I/O모드: 지연시간이 더 길지만, 처 설리량이 높고 병렬성이 높다. (빅데이터, 미디어 처리)
- Throughput Mode
  - Bursting: 스토리지가 늘어날 수록 처리량이 증가한다.
  - 프로비저닝: 스토리지 크기에 관계없이 처리량을 설정하는 경우에 이용된다.
  - Elastic: 워크로드에따라 처리량을 자동으로 조절할 수 있다. (워크로드를 예측하기 어려울 때 이용) 

#### EFS 스토리지 클래스
- 스토리지 계층
  - 스탠다드: 자주 액세스 하는 파일을 위한 계층
  - EFS-IA: 자주 액세스하지 않는 용도, 파일을 검색할 때는 비용이 발생하지만 저장하면 비용이 감소한다.
  - 아카이브: 거의 백세스 하지 않는 경우 이용 
  - Implement: 스토리지 계층 간에 파일을 자동으로 이동하기 위해 라이프 사이클 정책 정의

- EFS를 사용하면 90% 비용을 절감할 수 있다. 

# EBS vs EFS
- EBS..
  - 한번에 한 인스턴스와 연결 (io1/io2 제외)
  - AZ 제한
  - gp2 유형의 볼륨은 디스크의 크기가 증가해야 IO가 증가하는 반면 gp3, io1은 디스크 크기와 무관하게 IO를 증하시킬 수 있다. 
  - AZ간 EBS 볼륨을 옮기기 위해 스냄샷을 이용한다. 
  - EBS 백업이 IO를 사용하므로 애플리케이션이 많은 트래픽을 처리하고 있을 경우에는 실행하면 안된다.(성능에 영향을 줄 수 있다.)
  - EC2가 종료되면 기본적으로 EBS의 루트볼륨도 종료된다.(EBS 볼륨은 종료되지 않는다)
    
  ![alt text](\public\img\aws9-2.png){: width="500" height ="80" }

- EFS..
  - 서로 다른 가용영역의 소백개의 인스턴스에 연결될 수 있다.
  - 다른 AZ의 여러 마운트 대상을 가질 수 있다. 
  - POSIX를 사용하기 때문이 리눅스 시스템에서만 사용 가능하다.
  - EBS보다 가격대가 높지만, EFS-IA기능을 이용하면 비용 절감이 가능하다.
    
  ![alt text](\public\img\aws9-3.png){: width="500" height ="80" }