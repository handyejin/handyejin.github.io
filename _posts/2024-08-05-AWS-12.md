---
layout: post
title: AWS ELB 고정 세션, 교차 영역 로드 밸런싱, SSL/TLS 인증서
date: 2024-08-05
category: AWS
---

# AWS

> AWS DVA-C02 시험 공부 과정을 블로그에 기록하고자 한다!! <br>
> 강의는 [udemy](https://www.udemy.com/share/105Hxw3@0cQdz1131EH9l6miYRGC7Z2Im8bmTMdAo7U-M_IUQA0101eYlVeFerKpk6CkYQwlDA==/) 강의를 참고하였다.

<br>
# ELB 고정 세션 (Sticky Session)
- 로드밸런서에 2가지 요청을 수행하는 클라이언트가 요청에 응답하기 위해 백엔드에 동일한 인스턴스를 갖는 것
- CLB와 ALB에서도 설정할 수 있다. 
- 클라이언트에서 로드밸런서로 요청의 일부로 요청이 전달될 때 쿠키가 사용된다.
    - 쿠키가 만료되면 클라이언트가 다른 EC2인스턴스로 리다이션 된다. 
- 고정성을 활성화하면 백엔드 EC2 인스턴스 부하에 불균형을 초래할 수 있다.
- 일부 인스턴스는 고정 사용자를 갖게 된다.
 

#### 고정 세션의 쿠키
고정세션의 쿠기에는 2가지가 있다.
- 애플리케이션 기반 쿠키
  - 사용자 정의 쿠키
    - 대상으로 생성된 사용자 정의 쿠키로  애플리케이션에서 생성된다.
    - 애플리케이션에 필요한 모든 사용자 정의 속성을 포함할 수 있다. 
    - 쿠키 이름을 지정할 때 AWSALB, AWSALBAPP, AWSALBTG 같은 이름을 사용하면 안된다. (ELB에서 사용하기 때문에!)
  - 애플리케이션 쿠키
    - 로드밸런서 자체에서 생성된다.
    - 쿠키 이름은 AWSALBAPP 이다.
- 기반 쿠키
  - 쿠키 이름이 ALB에서는 AWSALB이며 CLB에서는 AWSELB 이다. 
  - 특정 기간을 기반으로 만료되며 그 **기간이 로드 밸런서 자체에서 생성**된다. 

# 교차 영역 로드 밸런싱(Cross-Zone Load Balancing)
- 트래픽을 모든 EC2 인스턴스로 균등하게 분산한다. 
- 교차 영역 로드밸런싱이 없을 때 트래픽은 가용영역에 한정되어 분배된다. 
  - 가용영역에 있는 EC2 인스턴스 개수가 불균형하면, 특정 가용영역에 있는 EC2 인스턴스는 더 많은 트래픽을 받게 된다. 

![alt text](\public\img\aws12-1.png){: width="500" height ="80" }
- 교차 영역 전체 인스턴스가 10%씩 트래픽을 받고 있다.

#### 애플리케이션 로드 밸런서
- 기본적으로 교차 영역 로드밸런싱이 활성화되어 있다.
  - 비활성화는 대상 그룹 레벨에서 가능하다.
  - 데이터가 가용영역으로 넘어가도 요금이 부과되지 않는다. (기본적으로 활성화되어있기 때문)

#### 네트워크 로드 밸런서 & 게이트웨이 로드 밸런서
- 기본적으로 교차 영역 로드밸런싱이 비활성화 되어있다. 
- 활성화를 할경우에 비용 발생
- 
#### 클래식 로드밸런서
- 기본적으로 비활성화 되어 있고, 만약 활성화를 해도 AZ간 이동하는 데이터에 대해 비용이 부과되지는 않는다.


# SSL/TLS
- SSL 인증서는 클라이언트와 로드 밸런서 사이에서 트래픽이 전송되는 동안 암호화되도록 해둔다. (전송중 암호화)
- SSL은 '보안 소켓 계층' 이라는 뜻이고 연결을 암호화할 때 사용한다.
- TLS는 SSL의 새 버전이고, '전송 계층 보안' 을 의미한다. 

- 퍼블릭 SSL인증서는 인증 기관에서 발행한다. 
- SSL 인증서에는 사용자가 정한 만료날짜가 있고 주기적으로 갱신해줘야 한다.

![alt text](\public\img\aws12-3.png){: width="700" height ="80" }
- 사용자는 HTTPS를 통해 연결하는데 'S'가 붙는것은 SSL 인증서여서 그렇다. 이는 암호화가 되었고 안전하다는 의미이다. 
- 로드밸런서는 X.509 인증서를 로딩하는데, SSL 혹은 TLS 서버 인증서라 불린다. 
- AWS에서는 ACM(AWS 인증서 매니저)를 활용해 SSL 인증서를 관리할 수 있다.
- HTTPS 리스너
  - 기본 인증서를 지정해줘야한다.
  - 인증서 목록을 추가해 여러 도메인을 지원할 수 있다. (선택 사항)
  - 클라이언트는 **SNI**를 활용해 도달하려는 호스트 네임을 지정할 수 있다. 
  - HTTPS에 특정 보안 정책을 설정해서 레거시 클라이언트라고 부르는 SSL과 TLS의 구버전을 지원할 수 있다. 

## SNI
- 하나의 웹 서버에 여러 SSL인증서를 로드해 웹 서버가 여러 사이트를 지원하게 만드는 방법이다. 
- 클라이언트가 초기 SSL 핸드셰이크에서 대상 서버의 호스트 네임을 표시해야 하는 새 프로토콜이다.
- 모든 클라이언트가 지원하지는 않는다. (ALB, NLB, Cloud Front를 활용할 때 적용할 수 있다.

**클래식 로드밸런서(v1)**
- 하나의 SSL 인증서만 지원한다. 
- 여러 인증서로 여러 호스트 네임을 사용하고 싶으면 클래식 로드밸런서를 여러개 사용하면 된다. 

**애플리케이션 로드 밸런서(v2)**
- 여러 SSL인증서로 여러 리스너를 지원할 수 있다.
- SNI 활용한다.

**네트워크 로드 밸런서(v2)**
- 여러 SSL인증서로 여러 리스너를 지원할 수 있다.
- SNI 활용한다.
